## Задача по PostgreSQL
Дано:
- Файл от **500 мб** до **1 гб**

Требуется:
- сохранить файл в бд в поле типа `bytea`.

При этом:
- размер таблицы не должен превышать размер файла более чем на **10%**;
- нельзя использовать `LargeObject (lo_*)` и `pg_read_large_file`;
- данные одного файла нужно сохранить в одной строке в таблице;
- нельзя использовать ORM.


## Идея
Так как по заданию нельзя использовать `LargeObject (lo_*)` и `pg_read_large_file`, можно попробовать разделить большой файл на мелкие части/сегменты/чанки и последовательно записать эти сегменты в базу.

В худшем случае ожидаем файл размером 1 Гб. При делении такого файла на 5 частей (далее пояснение почему именно на 5 частей), получим размер 1 чанка - 200 Мб.

Записывать в базу и читать из базы больше ~500 Мб нельзя (ошибка `out of memory`). Следовательно будем записывать и считывать максимум по 2 чанка, в нашем случае это дает в сумме +-400 Мб.

Создаем таблицу, в которой будем хранить:
- id файла - `file_id`;
- название файла - `file_name`;
- расширение файла - `file_type`;
- сегмент файла 1 - `file_chunk_1`;
- сегмент файла 2 - `file_chunk_2`;
- сегмент файла 3 - `file_chunk_3`;
- сегмент файла 4 - `file_chunk_4`;
- сегмент файла 5 - `file_chunk_5`.

> В данный момент не придумал реализации выполнения записи (в базу) и считывания информации (из базы) за 1 запрос.

**Реализация на запись в базу:**
- выполняем `INSERT` запрос, в котором записываем в базу название файла, расширение файла и 2 сегмента нашего файла (`file_chunk_1`, `file_chunk_2`);
- вполняем `UPDATE` запрос, в котором обновляем данные в ранее созданной строке. Добавляя следующие 2 сегмента (`file_chunk_3`, `file_chunk_4`);
- наконец последний `UPDATE` запрос, в котором обновляем данные строки, добавляя последний сегмент файла (`file_chunk_5`).

**Реализация на чтение из базы:**

Чтение из базы происходит по такой же схеме, что и запись в базу, только теперь мы делаем `SELECT` запросы и последовательно сохраняем наши чанки в list.

## Запуск

1. Установить и активировать виртуальное окружение:
```bash
python3 -m venv venv

bash/zsh
source venv/bin/activate

Windows:
venv\Scripts\activate.bat
```

2. Обновить `pip` и установить зависимости из `requirements.txt`:
```bash
pip install --upgrade pip

pip install -r requirements.txt
```

3. Запустить скрипт по созданию тестового файла размером 1Гб:
```bash
python3 create_1_gb_file.py
```

4. В файле `config.py` задать настройки подключения к базе данных:
```python
DBNAME = '<your_db_name>'
USER = '<your_db_user>'
PASSWORD = '<your_db_password>'
HOST = '<your_db_host>'
PORT = '<your_db_port>'
```
> Если хотите, чтобы файл записанный БД, был запрошен и пересобран, установите `RETURN_FILE_FROM_DB` в значение `True` (проверка, что данные не потеряны и файл не пересобирается битым)

> Название пересобранного файла будет состоять из: название вашего файла + добавка `_from_db` в конеце названия.

5. Запустить файл `run.py`:
```bash
python3 run.py
```
